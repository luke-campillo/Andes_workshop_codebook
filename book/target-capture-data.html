<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Target capture data | Andes Phylogenomics Workshop</title>
  <meta name="description" content="Step-by-step guide to a basic project in phylogenomics." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Target capture data | Andes Phylogenomics Workshop" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Step-by-step guide to a basic project in phylogenomics." />
  <meta name="github-repo" content="rachelss/Andes_workshop_codebook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Target capture data | Andes Phylogenomics Workshop" />
  
  <meta name="twitter:description" content="Step-by-step guide to a basic project in phylogenomics." />
  

<meta name="author" content="Rachel Schwartz" />


<meta name="date" content="2023-06-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="getting-your-data.html"/>
<link rel="next" href="plastome-variation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Andes Phylogenomics Workshop</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#case-studies"><i class="fa fa-check"></i><b>2.2</b> Case Studies</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#course-objectives"><i class="fa fa-check"></i><b>2.3</b> Course Objectives</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-and-analysis.html"><a href="data-and-analysis.html"><i class="fa fa-check"></i><b>3</b> Data and analysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-and-analysis.html"><a href="data-and-analysis.html#genomic-data"><i class="fa fa-check"></i><b>3.1</b> Genomic data</a></li>
<li class="chapter" data-level="3.2" data-path="data-and-analysis.html"><a href="data-and-analysis.html#phylogenies"><i class="fa fa-check"></i><b>3.2</b> Phylogenies</a></li>
<li class="chapter" data-level="3.3" data-path="data-and-analysis.html"><a href="data-and-analysis.html#comparative-analyses"><i class="fa fa-check"></i><b>3.3</b> Comparative analyses</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="computational-skills.html"><a href="computational-skills.html"><i class="fa fa-check"></i><b>4</b> Computational skills</a>
<ul>
<li class="chapter" data-level="4.1" data-path="computational-skills.html"><a href="computational-skills.html#log-in-to-the-server"><i class="fa fa-check"></i><b>4.1</b> Log in to the server</a></li>
<li class="chapter" data-level="4.2" data-path="computational-skills.html"><a href="computational-skills.html#basic-navigation"><i class="fa fa-check"></i><b>4.2</b> Basic navigation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="getting-your-data.html"><a href="getting-your-data.html"><i class="fa fa-check"></i><b>5</b> Getting your data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="getting-your-data.html"><a href="getting-your-data.html#repeating-analyses"><i class="fa fa-check"></i><b>5.1</b> Repeating analyses</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="target-capture-data.html"><a href="target-capture-data.html"><i class="fa fa-check"></i><b>6</b> Target capture data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="target-capture-data.html"><a href="target-capture-data.html#visual-inspection-of-data-eg-alignment-blast"><i class="fa fa-check"></i><b>6.1</b> Visual inspection of data (eg, alignment, BLAST)</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="plastome-variation.html"><a href="plastome-variation.html"><i class="fa fa-check"></i><b>7</b> Plastome variation</a></li>
<li class="chapter" data-level="8" data-path="variant-calling.html"><a href="variant-calling.html"><i class="fa fa-check"></i><b>8</b> Variant Calling</a></li>
<li class="chapter" data-level="9" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>9</b> Results</a>
<ul>
<li class="chapter" data-level="9.1" data-path="results.html"><a href="results.html#alignment"><i class="fa fa-check"></i><b>9.1</b> Alignment</a></li>
<li class="chapter" data-level="9.2" data-path="results.html"><a href="results.html#view-in-r"><i class="fa fa-check"></i><b>9.2</b> View in R</a></li>
<li class="chapter" data-level="9.3" data-path="results.html"><a href="results.html#trimal"><i class="fa fa-check"></i><b>9.3</b> Trimal</a></li>
<li class="chapter" data-level="9.4" data-path="results.html"><a href="results.html#concatenated-data-analysis"><i class="fa fa-check"></i><b>9.4</b> Concatenated data analysis</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="results.html"><a href="results.html#building-trees-with-iqtree"><i class="fa fa-check"></i><b>9.4.1</b> Building trees with IQTree</a></li>
<li class="chapter" data-level="9.4.2" data-path="results.html"><a href="results.html#viewing-trees"><i class="fa fa-check"></i><b>9.4.2</b> Viewing trees</a></li>
<li class="chapter" data-level="9.4.3" data-path="results.html"><a href="results.html#svdq"><i class="fa fa-check"></i><b>9.4.3</b> svdq</a></li>
<li class="chapter" data-level="9.4.4" data-path="results.html"><a href="results.html#mrbayes"><i class="fa fa-check"></i><b>9.4.4</b> MrBayes</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="results.html"><a href="results.html#species-tree-analyses"><i class="fa fa-check"></i><b>9.5</b> Species tree analyses</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="results.html"><a href="results.html#astral"><i class="fa fa-check"></i><b>9.5.1</b> ASTRAL</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="results.html"><a href="results.html#support-for-relationships"><i class="fa fa-check"></i><b>9.6</b> Support for relationships</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="results.html"><a href="results.html#bootstrap"><i class="fa fa-check"></i><b>9.6.1</b> Bootstrap</a></li>
<li class="chapter" data-level="9.6.2" data-path="results.html"><a href="results.html#scf-gcf"><i class="fa fa-check"></i><b>9.6.2</b> SCF / GCF</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="results.html"><a href="results.html#what-does-your-tree-tell-you"><i class="fa fa-check"></i><b>9.7</b> What does your tree tell you?</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="sharing-your-results.html"><a href="sharing-your-results.html"><i class="fa fa-check"></i><b>10</b> Sharing your results</a>
<ul>
<li class="chapter" data-level="10.1" data-path="sharing-your-results.html"><a href="sharing-your-results.html#presentation"><i class="fa fa-check"></i><b>10.1</b> Presentation</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Andes Phylogenomics Workshop</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="target-capture-data" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Target capture data<a href="target-capture-data.html#target-capture-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Much of the information in this chapter is drawn from the HybPiper tutorial, which can be found at <a href="https://github.com/mossmatters/HybPiper/wiki/Tutorial" class="uri">https://github.com/mossmatters/HybPiper/wiki/Tutorial</a></p>
<p>First make a folder in your home directory to hold your outputs for this component of the project.</p>
<p>We have pre-installed the program HybPiper, which assembles target sequences from short high-throughput DNA sequencing reads.
By assembling each target sequence for each species we will be able to produce a dataset that allows us to understand the evolutionary history of the species.</p>
<p>To access HybPiper run.
This activates a conda environment (don’t worry about this!).</p>
<pre><code>conda activate /mnt/homes4celsrs/shared/envs/hybpiper</code></pre>
<p>In this case, our target sequences are the Angiosperm 353 standard targets.
Target capture is a standard technique for sequencing many known loci simultaneously using a library of sequences.
We have provided you with low-coverage sequence data from using these target sequences as probes (your fastq files).
HybPiper first assigns each read to a particular target using alignment software (BWA).
These reads are then assembled using a standard genome assembler (Spades).
HybPiper outputs a fasta file of the (in frame) CDS portion of each sample for each target region.</p>
<p>The basic command for HybPiper is as follows:</p>
<pre><code>hybpiper assemble -t_dna targets.fasta -r species1_R*_test.fastq --prefix species1 --bwa --cpu 3</code></pre>
<p>Notice the commands and flags.
Move to the results directory in your workshop directory to run the following commands.
You should run this command, with the following changes:</p>
<ul>
<li>The argument for t_dna is the fasta file in the shared workshop folder - you will need to indicate a full relative path not just the file name</li>
<li>The argument for the the r flag is the filename(s) including paths for the fastq files of interest. Note the * indicates that we will use both pairs of the sequencing read files.</li>
<li>The prefix should be indicative of the species name</li>
<li>Note that we are sharing a server so we are specifying 3 cpu’s per group - if you are running on your own machine you can omit this flag and HybPiper will use all available resources. With limited shared resources this run may take a few minutes.</li>
</ul>
<p>To view your results, list the contents of the folder and folders inside this.
You should see a folder for each gene.
Within each folder you can see several fasta files, which you can view.</p>
<p>To automatically run all samples consecutively you will need to loop through them.
Go back and look at the prior example of loops.
One approach is to make a list of all the names of the species in a file and then read that and use them one at a time.</p>
<p>First we need to make the list. We want to automate this process because in some cases you could have a lot of samples. Additionally, copying and pasting names into a list is prone to error.
Additionally, once you automate this process you could repeat it easily and quickly for other datasets.
For starters make a list of just the R1 files (you don’t want R2 files because they have the same name so you would have duplicates).
First cd back to your data folder.
Output your list to a file in your results folder named <code>namelist.txt</code> by “redirecting” the output using <code>&gt;</code>.</p>
<pre><code>ls *R1* &gt; ~/evolution_workshop/results/namelist.txt </code></pre>
<p>Check that this worked using <code>cat</code> or by viewing the file and counting the number of lines..
We will need to adjust this output do remove the R1 label so that we can use wildcards to list both files together.
One approach is to notice a pattern in filenames: the files start with a sample identifier followed by an underscore followed by another identifier.
Thus, we can “cut off” all of the name after the second underscore and still have a unique name for our sample.
We use the “cut” command to make our data into columns using _ (specify a delimiter with -d), then we select the first two of these (use the field flag -f).</p>
<pre><code>ls *R1* | cut -d &#39;_&#39; -f 1,2 &gt; ~/evolution_workshop/results/namelist.txt </code></pre>
<p>Check this worked.
Now we can run HybPiper on all of our data sequentially.
In the following example, the species names are entered in the namelist.txt file.
The loop will iterate through them one at a time and run HybPiper.</p>
<pre><code>while read name
do 
    [insert command here]
done &lt; [path to]/namelist.txt</code></pre>
<p>To obtain some information about the results of this process use the <code>hybpiper stats</code> command as follows.</p>
<pre><code>hybpiper stats -t_dna [target file] gene [path to]/namelist.txt</code></pre>
<p>From <a href="https://hackmd.io/@mossmatters/HkPM7pwEK#Getting-HybPiper-Stats" class="uri">https://hackmd.io/@mossmatters/HkPM7pwEK#Getting-HybPiper-Stats</a></p>
<p>*hybpiper stats will generate two files, seq_lengths.tsv and hybpiper_stats.tsv</p>
<p>The first line of seq_lengths.tsv has the names of each gene. The second line has the length of the target gene, averaged over each “source” for that gene. The rest of the lines are the length of the sequence recovered by HybPiper for each gene. If there was no sequence for a gene, a 0 is entered.*</p>
<p>At this point, each sequence is in its own folder.
We can use HybPiper to fetch the sequences recovered for the same gene from multiple samples and generate a file for each gene. Use the following command,</p>
<pre><code>hybpiper retrieve_sequences dna -t_dna [target file]  --sample_names [path to]/namelist.txt</code></pre>
<p>Note that HybPiper has additional features we will not use in this workshop due to a lack of time.</p>
<div id="visual-inspection-of-data-eg-alignment-blast" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Visual inspection of data (eg, alignment, BLAST)<a href="target-capture-data.html#visual-inspection-of-data-eg-alignment-blast" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="getting-your-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="plastome-variation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-hybpiper.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
